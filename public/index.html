<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JamesKrayer.com | Checkers</title>
    <style>
      html,
      body {
        padding: 0;
        margin: 0;
      }
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }
      #board-wrapper {
        width: fit-content;
        height: fit-content;
        box-shadow: 0 0 20px 0 black;
      }
      #board {
        position: relative;
        width: 64vh;
        height: 64vh;
        background-color: bisque;
        border: 5px solid bisque;
        outline: 5px solid brown;
        box-shadow: 0 0 0 10px bisque;
      }
      .space {
        position: absolute;
        box-sizing: border-box;
        width: 8vh;
        height: 8vh;
        background-color: brown;
      }
      .row-1 {
        top: 0;
      }
      .row-2 {
        top: 8vh;
      }
      .row-3 {
        top: 16vh;
      }
      .row-4 {
        top: 24vh;
      }
      .row-5 {
        top: 32vh;
      }
      .row-6 {
        top: 40vh;
      }
      .row-7 {
        top: 48vh;
      }
      .row-8 {
        top: 56vh;
      }
      .col-1 {
        left: 0;
      }
      .col-2 {
        left: 8vh;
      }
      .col-3 {
        left: 16vh;
      }
      .col-4 {
        left: 24vh;
      }
      .col-5 {
        left: 32vh;
      }
      .col-6 {
        left: 40vh;
      }
      .col-7 {
        left: 48vh;
      }
      .col-8 {
        left: 56vh;
      }
      .piece {
        position: absolute;
        z-index: 1;
        width: 7vh;
        height: 7vh;
        border-radius: 50%;
        box-shadow: 0 0 5px 0 rgba(0, 0, 0, 0.3);
      }
      .player-1 {
        background-color: #111;
      }
      .player-2 {
        background-color: bisque;
      }
    </style>
  </head>
  <body>
    <div id="board-wrapper">
      <div id="board">
        <div class="space row-1 col-2"></div>
        <div class="space row-1 col-4"></div>
        <div class="space row-1 col-6"></div>
        <div class="space row-1 col-8"></div>
        <div class="space row-2 col-1"></div>
        <div class="space row-2 col-3"></div>
        <div class="space row-2 col-5"></div>
        <div class="space row-2 col-7"></div>
        <div class="space row-3 col-2"></div>
        <div class="space row-3 col-4"></div>
        <div class="space row-3 col-6"></div>
        <div class="space row-3 col-8"></div>
        <div class="space row-4 col-1"></div>
        <div class="space row-4 col-3"></div>
        <div class="space row-4 col-5"></div>
        <div class="space row-4 col-7"></div>
        <div class="space row-5 col-2"></div>
        <div class="space row-5 col-4"></div>
        <div class="space row-5 col-6"></div>
        <div class="space row-5 col-8"></div>
        <div class="space row-6 col-1"></div>
        <div class="space row-6 col-3"></div>
        <div class="space row-6 col-5"></div>
        <div class="space row-6 col-7"></div>
        <div class="space row-7 col-2"></div>
        <div class="space row-7 col-4"></div>
        <div class="space row-7 col-6"></div>
        <div class="space row-7 col-8"></div>
        <div class="space row-8 col-1"></div>
        <div class="space row-8 col-3"></div>
        <div class="space row-8 col-5"></div>
        <div class="space row-8 col-7"></div>
      </div>
    </div>
    <script>
      // Turn Switching should switch with checkers are draggable.
      const hasClass = (className) => (el) =>
        Array.from(el.classList).includes(className);
      const isSpace = hasClass("space");
      const isRow2 = hasClass("row-2");
      /*
        function dragstart_handler(ev) {
            // Add the target element's id to the data transfer object
            ev.dataTransfer.setData("text/plain", ev.target.id);
        }

        function dragover_handler(ev) {
            ev.preventDefault();
            ev.dataTransfer.dropEffect = "move";
        }

        function drop_handler(ev) {
            ev.preventDefault();
            // Get the id of the target and add the moved element to the target's DOM
            const data = ev.dataTransfer.getData("text/plain");
            ev.target.appendChild(document.getElementById(data));
        }
        */

      var piece = null;

      window.addEventListener("DOMContentLoaded", () => {
        const board = document.getElementById("board");
        const spaces = board.getElementsByClassName("space");
        // Get the element by id
        // const element = document.getElementById("p1");
        // Add the ondragstart event listener
        // element.addEventListener("dragstart", dragstart_handler);

        board.addEventListener("dragstart", (e) => {
          console.log("dragstart", e);
          e.dataTransfer.effectAllowed = "move";
          piece = e.target;
        });

        board.addEventListener("dragend", (e) => {
          console.log("dragend", e);
          // if (isSpace(e.target)) return false
        });

        board.addEventListener("dragover", (e) => {
          e.preventDefault();
          console.log("dragover", e);
          // if (isSpace(e.target)) return false
        });

        board.addEventListener("dragenter", (e) => {
          console.log("dragenter", e);
          // highlight potential drop target when the draggable element enters it
          // if (isSpace(event.target)) {
          //     console.log('dragenter', e)
          //     event.target.style.background = "purple";
          // }
        });

        board.addEventListener("dragleave", (e) => {
          console.log("dragleave", e);
          // reset background of potential drop target when the draggable element leaves it
          // if (isSpace(event.target)) {
          // event.target.style.background = "";
          // }
        });

        board.addEventListener("drop", (e) => {
          e.preventDefault();
          console.log("drop", e);
          if (isSpace(e.target) && !isRow2(e.target)) {
            // event.target.style.background = "";
            piece.parentNode.removeChild(piece);
            event.target.appendChild(piece);
            piece = null;
            return true;
          }

          return false;
        });
      });

      const PlayerOne = {
        pieces: [
          [1, 0],
          [3, 0],
          [5, 0],
          [7, 0],
          [0, 1],
          [2, 1],
          [4, 1],
          [6, 1],
          [1, 2],
          [3, 2],
          [5, 2],
          [7, 2],
        ],
        // may want this to be a map so you can do
        // piece x: [x,y]
      };

      const BOARD = {
        pieces: [
          {
            coord: [1, 0],
            owner: "player-1",
          },
          {
            coord: [3, 0],
            owner: "player-1",
          },
          {
            coord: [5, 0],
            owner: "player-1",
          },
          {
            coord: [7, 0],
            owner: "player-1",
          },
          {
            coord: [0, 1],
            owner: "player-1",
          },
          {
            coord: [2, 1],
            owner: "player-1",
          },
          {
            coord: [4, 1],
            owner: "player-1",
          },
          {
            coord: [6, 1],
            owner: "player-1",
          },
          {
            coord: [1, 2],
            owner: "player-1",
          },
          {
            coord: [3, 2],
            owner: "player-1",
          },
          {
            coord: [5, 2],
            owner: "player-1",
          },
          {
            coord: [7, 2],
            owner: "player-1",
          },
        ],
      };

      function getPosition(x, y) {
        const pos = (n) => n * 8 + 0.5;
        return `left:${pos(x)}vw; top:${pos(y)}vw;`;
      }

      function renderBoard(brd) {
        brd.pieces.forEach(({ coord, owner }) => {
          const d = document.createElement("DIV");
          d.setAttribute("class", `piece ${owner}`);
          d.setAttribute("draggable", "true");
          d.setAttribute("style", getPosition(...coord));

          board.appendChild(d);
        });
      }

      function gameSetup() {
        renderBoard(BOARD);
      }

      window.addEventListener("DOMContentLoaded", gameSetup);
    </script>
    <script type="module" src="/scripts/lib.js"></script>
    <script type="module" src="/scripts/checkers.js"></script>
    <script type="module">
      import { initialState, move } from "/scripts/checkers.js";

      let state = initialState();

      state = move(state, [1, 2], [0, 3]);
      // state = move(state, [0, 5], [1, 4]);
      // state = move(state, [0, 3], [1, 2]); // Should be bad move because it's p2 turn

      console.log(state);
    </script>
  </body>
</html>
